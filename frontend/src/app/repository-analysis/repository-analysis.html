<mat-card class="repository-card">
  <div class="header-row">
    <div class="header-title-wrapper">
      <h2 class="mat-title">Validation Report Generator</h2>
    </div>
    <div class="description-text">
      Generate validation report for input fields from a Github or Bitbucket
      repository.
    </div>
  </div>


    
  
  <div class="input-group-vertical">
    <label class="input-label">Enter repository URL</label>
  <input
    type="text"
    [(ngModel)]="repoUrl"
    class="custom-input-field"
    placeholder="https://github.com/username/repo"
    [disabled]="isLoading"
  />
  <small class="text-muted">Github or Bitbucket url suppoerted</small>
</div>


  <div class="button-center-wrapper">
    <button
      mat-raised-button
      class="analyze-btn"
      (click)="analyzeRepo()"
      [disabled]="!repoUrl.trim() || isLoading"
      [ngClass]="{ 'disabled-btn': !repoUrl.trim() || isLoading }"
    >
      <mat-icon>search</mat-icon>
      <span>Analyze</span>
    </button>
    <button
      mat-raised-button
      class="reset-btn"
      color="warn"
      (click)="resetAnalysis()"
      [disabled]="!repoUrl.trim() || isLoading"
      [ngClass]="{ 'disabled-btn': !repoUrl.trim() || isLoading }"
    >
      <mat-icon>refresh</mat-icon>
      <span>Reset</span>
    </button>
  </div>

  <div *ngIf="isLoading" class="loading-indicator-wrapper">
    <div class="loading-indicator">
      <mat-icon class="loading-icon spin">autorenew</mat-icon>
      <div class="loading-text">Analyzing Repository...</div>
      <button
        mat-raised-button
        class="cancel-btn"
        color="warn"
        (click)="cancelAnalysis()"
      >
        <mat-icon>cancel</mat-icon>Cancel
      </button>
    </div>
  </div>

  <div *ngIf="showDownloadPopup" class="modal-backdrop">
    <div class="modal-box">
      <mat-icon class="modal-icon">check_circle</mat-icon>
      <p class="modal-text">{{ downloadPopupMessage }}</p>
      <button mat-raised-button (click)="closePopup()">OK</button>
    </div>
  </div>

  <div *ngIf="errorMessage" class="error-alert">
    <mat-icon>error_outline</mat-icon>
    {{ errorMessage }}
  </div>

  <div *ngFor="let entity of jsonResponse?.entities" class="entity-table">
    <h3 class="entity-title">{{ entity.name }}</h3>

    <div *ngIf="entity.note" class="note-text">
      <mat-icon>info</mat-icon>
      {{ entity.note }}
    </div>

    <table *ngIf="entity.fields?.length" class="table">
      <thead>
        <tr>
          <th *ngFor="let key of getFieldKeys(entity.fields)">{{ key }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let field of entity.fields">
          <td *ngFor="let key of getFieldKeys(entity.fields)">
            {{ field[key] ?? "â€”" }}
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!entity.note && !entity.fields?.length" class="note-text">
      <mat-icon>help</mat-icon>
      No note or fields found for this entity.
    </div>
  </div>

  <div class="button-container" *ngIf="jsonResponse">
    <button mat-raised-button class="analyze-btn" (click)="downloadJSON()">
      <mat-icon>download</mat-icon>
      <span>Download JSON Report</span>
    </button>

    <button
      mat-raised-button
      class="analyze-btn"
      style="margin-left: 1rem"
      (click)="downloadPDF()"
    >
      <mat-icon>picture_as_pdf</mat-icon>
      <span>Download PDF Report</span>
    </button>
  </div>
</mat-card>
